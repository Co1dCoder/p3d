(function(){var f,w,d,v,h,j,e,p,n,o,l,q,t,s,u,i,g,a,r,c,m=this,b=function(k,x){return function(){return k.apply(x,arguments)
}};h=true;s=function(x,k){return x.slice(0,+(k.length-1)+1||9000000000)===k};j=function(B,C){var y,x,A,k,z;
z=B.split(/\r?\n/);for(y=A=0,k=z.length;A<k;y=++A){x=z[y];C(x,y)}return void 0};d=function(k){return""+(k[0].toUpperCase())+k.slice(1)
};t=function(k){if(k>0){return +1}else{if(k<0){return -1}else{return 0}}};e=function(k){return k.split(".").pop()
};f=function(k,y){var x;x=new XMLHttpRequest();x.open("GET",k.url,true);x.responseType="blob";
if(y!=null){x.onload=(function(){return y(x.response)})}x.send();return x};l=function(x){var k;
if(self.DOMParser){return new DOMParser().parseFromString(x,"text/xml")}else{k=new ActiveXObject("Microsoft.XMLDOM");
k.async=false;return xml.loadXML(x)}};p=function(A,x,z){var C,y,B,k;C=[[2*Math.pow(A,3)-3*Math.pow(A,2)+1,Math.pow(A,3)-2*Math.pow(A,2)+A],[-2*Math.pow(A,3)+3*Math.pow(A,2),Math.pow(A,3)-Math.pow(A,2)]];
k=[];for(y=B=0;B<=2;y=++B){k.push(x[0][y]*C[0][0]+z[0][y]*C[0][1]+x[1][y]*C[1][0]+z[1][y]*C[1][1])
}return k};w=function(E){var K,A,J,C,I,H,G,F,D,z,y,x,k,B;A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
z=void 0;y=void 0;x=void 0;I=void 0;H=void 0;G=void 0;F=void 0;J=void 0;D=0;K=0;C="";
B=[];if(!E){return E}while(true){z=E.charCodeAt(D++);y=E.charCodeAt(D++);x=E.charCodeAt(D++);
J=z<<16|y<<8|x;I=J>>18&63;H=J>>12&63;G=J>>6&63;F=J&63;B[K++]=A.charAt(I)+A.charAt(H)+A.charAt(G)+A.charAt(F);
if(!(D<E.length)){break}}C=B.join("");k=E.length%3;return(k?C.slice(0,k-3):C)+"===".slice(k||3)
};n=self.document===void 0;u=["normals","vertices","indices","nOfTriangles","chunks"];
if(!n){i=arguments.callee;g=function(){var x,k;if(m.webWorkerURL!=null){return m.webWorkerURL
}x=i.toString();x=x.replace(/^\s*function\s*\(\) {/,"").replace(/}\s*$/,"");k=new Blob([x],{type:"text/javascript"});
return m.webWorkerURL=(window.URL||window.webkiURL).createObjectURL(k)}}else{q=null;
v=null;this.onmessage=function(z){var K,F,B,y,J,G,E,C,I,A,x,H,D;y=new P3D.Parser(z.data);
B={};for(G=0,I=u.length;G<I;G++){F=u[G];B[F]=y[F]}J=(function(){var M,L,N,k;N=["normals","vertices","indices"];
k=[];for(M=0,L=N.length;M<L;M++){F=N[M];k.push(y[F].buffer)}return k})();H=y.chunks;
for(E=0,A=H.length;E<A;E++){K=H[E];D=["normals","vertices","indices"];for(C=0,x=D.length;
C<x;C++){F=D[C];J.push(K[F].buffer)}}return postMessage(B,J)}}self.P3D=(function(){k.prototype._fileTypeWhitelist=["Stl","Amf","Obj"];
function k(y){this._onReaderLoad=b(this._onReaderLoad,this);var x,z=this;this.src=y;
x=arguments;this.opts=x.length>2?x[1]:{background:true};this.callback=x[x.length-1];
this.filename=typeof this.src==="string"?this.src.split("/").pop().replace("/",""):this.src.name;
this.fileType=d(e(this.filename).toLowerCase());if(this._fileTypeWhitelist.indexOf(this.fileType)===-1){throw"Unable to parse file extension or unsupported file extension: "+this.fileType
}if(this.fileType==="Amf"){this.opts.background=false}if(typeof this.src==="string"){f({url:this.src},function(A){return z._initReader("Text",A)
})}else{this._initReader("Text",this.src)}}k.prototype._initReader=function(y,x){var z;
this.dataType=y;this.blob=x;z=this.reader=new FileReader();z.onload=this._onReaderLoad;
return z["readAs"+y](x)};k.prototype._binaryStlCheck=function(x){return this.fileType==="Stl"&&this.dataType==="Text"&&x.slice(0,81).match(/^solid /)===null
};k.prototype._onReaderLoad=function(){v=this.reader.result;delete this.reader;if(this._binaryStlCheck(v)){return this._initReader("ArrayBuffer",this.blob)
}delete this.blob;return this._parse(v)};k.prototype._dataTypeInfo=function(){if(this.dataType==="Text"){return"Text"
}else{return"Binary"}};k.prototype._parsingDebugMsg=function(x){var z,y;if(h){if(x===true){z=(new Date().getTime()-this._parserStartMs)/1000;
y="[ DONE "+z+"s ]"}else{this._parserStartMs=new Date().getTime();y=""}return console.log("Parsing "+this.filename+" as "+(this._dataTypeInfo().toLowerCase())+" "+(this.fileType.toUpperCase())+".. "+y)
}};k.prototype._parse=function(y){var x,z,A=this;this._parsingDebugMsg(false);x={pipeline:["_parse"+this.dataType+this.fileType,"split"],data:y};
if(this.opts.background===true){console.log("Running as a background job");z=new Worker(g());
z.onmessage=function(B){return A._onParsingComplete(B.data)};z.addEventListener("error",(function(B){return console.log(B)
}),false);z.postMessage=z.webkitPostMessage||z.postMessage;return z.postMessage(x,this.dataType==="Text"?[]:[y])
}else{return this._onParsingComplete(new k.Parser(x))}};k.prototype._onParsingComplete=function(A){var y,z,x;
for(z=0,x=u.length;z<x;z++){y=u[z];this[y]=A[y]}this.verts=this.vertices;this._parsingDebugMsg(true);
return this.callback(this)};k.prototype.exportTextStl=function(){var x,z,y;y="solid P3D\n";
x=function(B,A){return(t(B)>=0||A===0?" ":"")+B.toExponential(6)};z=function(C,A){var B;
return((function(){var E,D;D=[];for(B=E=0;E<=2;B=++E){D.push(x(C[B],A?B:1))}return D
})()).join(" ")};this._eachFace(function(F,C){var B,E,A,D;y+="  facet normal "+(z(F.normals[0],false))+"\n";
y+="    outer loop\n";D=F.vertices;for(E=0,A=D.length;E<A;E++){B=D[E];y+="      vertex "+(z(B,true))+"\n"
}y+="    endloop\n";return y+="  endfacet\n"});y+="endsolid P3D";y=y.replace(/e\+([0-9][^0-9])/g,"e+0$1");
y=y.replace(/e\-([0-9][^0-9])/g,"e-0$1");return new Blob([y],{type:"application/octet-stream"})
};return k})();self.P3D.Parser=(function(){function k(y){this.split=b(this.split,this);
this._eachFace=b(this._eachFace,this);var B,A,x,z;this[y.pipeline[0]](y.data);z=y.pipeline.slice(1);
for(A=0,x=z.length;A<x;A++){B=z[A];this[B]()}}k.prototype._toMillimeters=function(y){var x,z;
x={mm:1,millimeter:1,meter:1000,inch:25.4,feet:304.8,micron:0.001};z=x[y.toLowerCase()];
if(z!=null){return z}throw""+y+" is not a known unit of measurement"};k.prototype._initGeometry=function(x,z){var y,C,B,A;
this.nOfTriangles=x;this.normals=new Float32Array(this.nOfTriangles*9);this.vertices=this.verts=new Float32Array(this.nOfTriangles*9);
if(z!=null){this.indices=new Uint32Array(z)}else{C=this.indices=new Uint32Array(this.nOfTriangles*3);
for(y=B=0,A=C.length;0<=A?B<=A:B>=A;y=0<=A?++B:--B){C[y]=y}}return[this.normals,this.verts,this.indices]
};k.prototype._addFace=function(E,G,C){var D,A,y,z,F,B,x;B=["vertices","normals"];
x=[];for(z=0,F=B.length;z<F;z++){D=B[z];x.push((function(){var I,H;H=[];for(y=I=0;
I<=2;y=++I){H.push((function(){var K,J;J=[];for(A=K=0;K<=2;A=++K){J.push(G[D][C+A*3+y]=E[D][A][y])
}return J})())}return H})())}return x};k.prototype._expandVerts=function(){var H,B,F,D,C,z,I,x,E,A,y,G=this;
this.nOfTriangles=this.indices.length/3;B={};E=["vertices","normals"];for(D=0,I=E.length;
D<I;D++){H=E[D];B[H]=new Float32Array(this.nOfTriangles*9)}this._eachFace(function(K,J){return G._addFace(K,B,J*9)
});for(F=C=0,A=this.indices.length-1;0<=A?C<=A:C>=A;F=0<=A?++C:--C){this.indices[F]=F
}y=["vertices","normals"];for(z=0,x=y.length;z<x;z++){H=y[z];this[H]=B[H]}return this.verts=this.vertices
};k.prototype._parseTextAmf=function(R){var H,U,F,K,Z,I,J,S,M,L,Q,X,T,Y,V,ae,O,aa,x,af,E,ac,G,P,B,z,y,ab,ad,N,D,C,A,W=this;
G=l(R);V=G.documentElement;P=function(ag){return G.evaluate(ag,G,null,XPathResult.ANY_TYPE,null)
};Y=function(ah,ag){return ah.getElementsByTagName(ag)[0].textContent};H=function(ai,aj){var ah,ag;
ag=P(ai);while((ah=ag.iterateNext())!=null){aj(ah)}return void 0};af=V.getAttribute("unit")||V.getAttribute("units");
ae=this._toMillimeters(af);E=0;I=0;L=P("count(//triangle)").numberValue;Q=P("count(//vertex)").numberValue;
N=this._initGeometry(Q,L*3),T=N[0],ac=N[1],J=N[2];H("//vertex",function(ah){var ao,am,ak,ag,an,al,ap,aj,ai;
ao=ah.getElementsByTagName("coordinates")[0];an=ah.getElementsByTagName("normal");
if(an.length===1){ag=(function(){var au,at,aq,ar;aq=["nx","ny","nz"];ar=[];for(am=au=0,at=aq.length;
au<at;am=++au){ak=aq[am];ar.push(T[E+am]=parseFloat(Y(an[0],ak)))}return ar})()}aj=["x","y","z"];
ai=[];for(al=0,ap=aj.length;al<ap;al++){ak=aj[al];ai.push(ac[E++]=parseFloat(Y(ao,ak))*ae)
}return ai});H("//triangle",function(ai){var ah,aj,ag;ag=[];for(ah=aj=1;aj<=3;ah=++aj){ag.push(J[I++]=parseInt(Y(ai,"v"+ah)))
}return ag});S=function(ah){var ai,ag;return((ai=ah.normals)[0]===(ag=ai[1])&&ag===ai[2])
};F=function(ah,ag){return[ah[1]*ag[2]-ah[2]*ag[1],ah[2]*ag[0]-ah[0]*ag[2],ah[0]*ag[1]-ah[1]*ag[0]]
};M=function(ag){return Math.sqrt(Math.pow(ag[0],2)+Math.pow(ag[1],2)+Math.pow(ag[2],2))
};X=function(ah){var ai,aj,ak,ag;aj=M(ah);ag=[];for(ai=ak=0;ak<=2;ai=++ak){ag.push(ah[ai]=ah[ai]/aj)
}return ag};this._expandVerts();L=this.nOfTriangles;this._eachFace(this._calculateVertexNormals);
aa=4;x=Math.pow(4,aa);this._eachFace(function(ag){if(!S(ag)){return L+=x-1}});K={};
D=["vertices","normals"];for(B=0,ab=D.length;B<ab;B++){U=D[B];K[U]=new Float32Array(L*9)
}E=0;O=function(am,ag){var at,aw,al,av,au,ak,aq,ar,aj,ax,ao,an,ap,ah,ay,ai;aq=[];
ak=[];ai=[[0,1],[1,2],[2,0]];for(ah=0,ay=ai.length;ah<ay;ah++){al=ai[ah];an=[am.vertices[al[0]],am.vertices[al[1]]];
ar=[am.normals[al[0]],am.normals[al[1]]];aw=(function(){var aA,az;az=[];for(av=aA=0;
aA<=2;av=++aA){az.push(an[1][av]-an[0][av])}return az})();ao=(function(){var aA,az;
az=[];for(av=aA=0;aA<=1;av=++aA){at=F(F(ar[av],aw),ar[av]);az.push((function(){var aC,aB;
aB=[];for(au=aC=0;aC<=2;au=++aC){aB.push(M(aw)*at[au]/M(at))}return aB})())}return az
})();aq.push(ap=p(0.5,an,ao,ag));ak.push(aj=X((function(){var aA,az;az=[];for(av=aA=0;
aA<=2;av=++aA){az.push((ar[1][av]+ar[0][av])/2)}return az})()))}ax=(function(){var aA,az;
az=[];for(av=aA=0;aA<=2;av=++aA){az.push({vertices:[aq[av],aq[au=(av+2)%3],am.vertices[av]],normals:[ak[av],ak[au],am.normals[av]]})
}return az})();ax.push({vertices:aq,normals:ak});return ax};this._eachFace(function(aq,ah){var aw,ar,am,av,au,at,ax,al,aj,ai,aD,aB,az,ay,ag,aE,aC,aA,ap,ao,ak,an;
if(S(aq)){ap=["vertices","normals"];for(al=0,aD=ap.length;al<aD;al++){U=ap[al];for(at=aj=0;
aj<=2;at=++aj){for(au=ai=0;ai<=2;au=++ai){K[U][E+au*3+at]=aq[U][au][at]}}}return E+=9
}else{am=[aq];ax=[];for(av=ag=0,ao=aa-1;0<=ao?ag<=ao:ag>=ao;av=0<=ao?++ag:--ag){ax=[];
for(aE=0,aB=am.length;aE<aB;aE++){aw=am[aE];ak=O(aw,ah+Math.pow(4,av));for(aC=0,az=ak.length;
aC<az;aC++){ar=ak[aC];ax.push(ar)}}am=ax}an=[];for(aA=0,ay=ax.length;aA<ay;aA++){aw=ax[aA];
W._addFace(aw,K,E);an.push(E+=9)}return an}});J=this.indices=new Float32Array(L*3);
for(Z=z=0,C=this.indices.length-1;0<=C?z<=C:z>=C;Z=0<=C?++z:--z){this.indices[Z]=Z
}A=["vertices","normals"];for(y=0,ad=A.length;y<ad;y++){U=A[y];this[U]=K[U]}this.verts=this.vertices;
this.nOfTriangles=L;this._eachFace(this._calculateVertexNormals);this.nOfTriangles=L;
return void 0};k.prototype._parseEachLine=function(B,A,z,C){var x,y;y=0;x=function(D){return j(B,function(E,F){if(F>=z.headerLines){return D(E,F)
}})};x(function(D){if(D.indexOf(A.face)!==-1){return y++}});this._initGeometry(y);
x(function(D,E){D=D.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").toLowerCase();
return C(D,E)});return void 0};k.prototype._parseTextObj=function(z){var B,y,x,A=this;
y={normal:"vn ",vert:"v ",face:"f "};B=0;x=0;this._parseEachLine(z,y,{headerLines:0},function(N,I){var M,J,L,F,G,E,K,C,H,D;
if(s(N,y.vert)){F=N.split(/\s/).slice(1);if(F.length<3){throw"Parsing Error: "+F.length+" vector vertex"
}H=F.slice(0,3);for(G=0,K=H.length;G<K;G++){M=H[G];A.vertices[x++]=L=parseFloat(M);
if(isNaN(L)||!isFinite(L)){throw"Parsing Error: Vertex vector #"+x+" is not a number"
}}}else{if(s(N,y.face)){D=N.split(/\s/).slice(1);for(E=0,C=D.length;E<C;E++){J=D[E];
A.indices[B++]=parseInt(J.split("/")[0])-1}}}return void 0});this._expandVerts();
this._eachFace(this._calculateVertexNormals);return void 0};k.prototype._parseTextStl=function(B){var z,x,A,y,C=this;
A={normal:"facet normal ",vert:"vertex ",face:"facet"};z=["outer","endloop","facet","endfacet","endsolid"];
x=0;y=0;this._parseEachLine(B,A,{headerLines:1},function(E,H){var G,J,F,I,K,D;if(s(E,A.vert)){I=E.split(/\s/).slice(1);
if(I.length!==3){throw"Parsing Error: "+I.length+" vector vertex"}for(K=0,D=I.length;
K<D;K++){J=I[K];C.vertices[y++]=F=parseFloat(J);if(isNaN(F)||!isFinite(F)){throw"Parsing Error: Vertex vector #"+y+" is not a number"
}}}else{if(E.length>0){if((function(){var N,M,L;L=[];for(N=0,M=z.length;N<M;N++){G=z[N];
L.push(s(E,G))}return L})()){return}throw"Parsing Error: Invalid Line \n "+E}}return void 0
});this._eachFace(this._calculateVertexNormals);return void 0};k.prototype._parseArrayBufferStl=function(I){var A,H,N,F,x,J,y,D,L,K,E,C,z,M,G,B;
v=new DataView(I,80);A=0;M=function(Q,O){var P;P=v[Q](A,true);A+=O;return P};y=function(){return M("getFloat32",4)
};L=function(){return M("getUint32",4)};D=function(){return M("getUint16",2)};x=L();
G=this._initGeometry(x),J=G[0],K=G[1],N=G[2];for(H=E=0,B=x-1;0<=B?E<=B:E>=B;H=0<=B?++E:--E){for(F=C=0;
C<=2;F=++C){y()}for(F=z=0;z<=8;F=++z){K[H*9+F]=y()}D()}this._eachFace(this._calculateVertexNormals);
return void 0};k.prototype._eachFace=function(y){var x,B,A,z;B=this.indices;for(x=A=0,z=this.indices.length-3;
A<=z;x=A+=3){y(this._face(B.subarray(x,x+3)),x/3)}return void 0};k.prototype._face=function(x){var y;
return{indices:x,normals:(function(){var B,A,z;z=[];for(B=0,A=x.length;B<A;B++){y=x[B];
z.push(this.normals.subarray(y*3,y*3+3))}return z}).call(this),vertices:(function(){var B,A,z;
z=[];for(B=0,A=x.length;B<A;B++){y=x[B];z.push(this.vertices.subarray(y*3,y*3+3))
}return z}).call(this)}};k.prototype._flipFace=function(y){var x;x=y.indices[0];y.indices[0]=y.indices[1];
return y.indices[1]=x};k.prototype._calculateVertexNormals=function(C){var B,A,E,F,D,z,y,x;
F=(function(){var H,G;G=[];for(B=H=1;H<=2;B=++H){G.push((function(){var J,I;I=[];
for(A=J=0;J<=2;A=++J){I.push(C.vertices[B][A]-C.vertices[0][A])}return I})())}return G
})();D=[(F[0][1]*F[1][2])-(F[0][2]*F[1][1]),(F[0][2]*F[1][0])-(F[0][0]*F[1][2]),(F[0][0]*F[1][1])-(F[0][1]*F[1][0])];
E=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);for(B=z=0;z<=2;B=++z){D[B]=D[B]/E}x=[];
for(B=y=0;y<=2;B=++y){if(C.normals[B][0]===0&&C.normals[B][1]===0&&C.normals[B][2]===0){x.push((function(){var H,G;
G=[];for(A=H=0;H<=2;A=++H){G.push(C.normals[B][A]=D[A])}return G})())}else{x.push(void 0)
}}return x};k.prototype.split=function(){var x,A,y,z,E,C,B,D;x=Math.pow(2,16);x-=x%9;
return this.chunks=(function(){var N,M,J,H,P,F,G,O,L,I,K;K=[];for(D=N=0,O=this.indices.length-1;
0<=O?N<=O:N>=O;D=N+=x){C=this.indices.subarray(D,D+x);B={indices:new Uint16Array(C.length),vertices:[],normals:[]};
for(A=M=0,L=B.indices.length-1;0<=L?M<=L:M>=L;A=0<=L?++M:--M){B.indices[A]=A}for(z=J=0,P=C.length;
J<P;z=++J){E=C[z];for(y=H=0;H<=2;y=++H){B.vertices[z*3+y]=this.vertices[E*3+y];B.normals[z*3+y]=this.normals[E*3+y]
}}I=["vertices","normals"];for(G=0,F=I.length;G<F;G++){y=I[G];B[y]=new Float32Array(B[y])
}K.push(B)}return K}).call(this)};return k})();c=["_eachFace","_face"];for(a=0,r=c.length;
a<r;a++){o=c[a];P3D.prototype[o]=P3D.Parser.prototype[o]}}).call(this);